<!DOCTYPE html>

<html>
<head>
  <title>IperGraph.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="index.html">
                index.js
              </a>
            
              
              <a class="source" href="IperEdge.html">
                IperEdge.js
              </a>
            
              
              <a class="source" href="IperElement.html">
                IperElement.js
              </a>
            
              
              <a class="source" href="IperGraph.html">
                IperGraph.js
              </a>
            
              
              <a class="source" href="IperNode.html">
                IperNode.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>IperGraph.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h1>IperGraph</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="keyword">var</span> _    = require(<span class="string">'underscore'</span>)
  , util = require(<span class="string">'util'</span>)

<span class="keyword">var</span> IperEdge    = require(<span class="string">'./IperEdge'</span>)
  , IperElement = require(<span class="string">'./IperElement'</span>)
  , IperNode    = require(<span class="string">'./IperNode'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Constructor</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="function"><span class="keyword">function</span> <span class="title">IperGraph</span><span class="params">(data)</span> {</span>

  IperElement.call(<span class="keyword">this</span>)

  <span class="keyword">this</span>.edges = {}
  <span class="keyword">this</span>.nodes = {}</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">getData</span><span class="params">()</span> {</span>
    <span class="keyword">var</span> data = {nodes:{}, edges:{}}

    <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> <span class="keyword">this</span>.nodes) {
      <span class="keyword">var</span> node = <span class="keyword">this</span>.nodes[i]
      data.nodes[node.id] = node.data
    }

    <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> <span class="keyword">this</span>.edges) {
      <span class="keyword">var</span> edge = <span class="keyword">this</span>.edges[i]
      data.edges[edge.id] = edge.nodeIds
    }

    <span class="keyword">return</span> data
  }

  Object.defineProperty(<span class="keyword">this</span>, <span class="string">'data'</span>, {get: getData})</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>try to load data passed to constructor</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">try</span> {
    load(data)
  }
  <span class="keyword">catch</span> (ignore) {}
}

util.inherits(IperGraph, IperNode)

<span class="function"><span class="keyword">function</span> <span class="title">check</span><span class="params">(data)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>data.edges has existing nodeIds</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">for</span> (<span class="keyword">var</span> edgeId <span class="keyword">in</span> data.edges) {
    <span class="keyword">var</span> edgeData = data.edges[edgeId]
    <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> edgeData) {
      <span class="keyword">var</span> nodeId = edgeData[i]
      <span class="keyword">if</span> (<span class="keyword">typeof</span> data.nodes[nodeId] === <span class="string">'undefined'</span>)
        <span class="keyword">throw</span> <span class="keyword">new</span> Error()
    }
  }
  <span class="keyword">return</span> <span class="literal">true</span>
}
IperGraph.prototype.check = check

<span class="function"><span class="keyword">function</span> <span class="title">load</span><span class="params">(data)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>check if data is valid</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">try</span> {
    check(data)
  }
  <span class="keyword">catch</span> (er) { <span class="keyword">throw</span> er }</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>store a lookup of new &lt;--&gt; old ids</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> nu = {}</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>create new nodes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">for</span> (<span class="keyword">var</span> id <span class="keyword">in</span> data.nodes) {
    nu[id] = <span class="keyword">this</span>.createNode(data.nodes[id])
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>create new edges</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">for</span> (<span class="keyword">var</span> id <span class="keyword">in</span> data.edges) {
    <span class="keyword">var</span> nodeIds = []
    <span class="keyword">var</span> oldNodeIds = data.edges[id]

    <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> oldNodeIds) {
      nodeId = oldNodeIds[i]
      nodeIds.push(nu[nodeId])
    }

    <span class="keyword">this</span>.createEdge(nodeIds)
  }
}
IperGraph.prototype.load = load

<span class="function"><span class="keyword">function</span> <span class="title">createEdge</span><span class="params">(nodeIds)</span> {</span>
  <span class="keyword">var</span> edge = <span class="keyword">new</span> IperEdge(<span class="keyword">this</span>, nodeIds)
  <span class="keyword">this</span>.edges[edge.id] = edge
  <span class="keyword">return</span> edge.id;
}
IperGraph.prototype.createEdge = createEdge

<span class="function"><span class="keyword">function</span> <span class="title">getEdge</span><span class="params">(id)</span> {</span>
  <span class="keyword">var</span> edge = <span class="keyword">this</span>.edges[id]

  <span class="keyword">if</span> (_.isUndefined(edge))
    <span class="keyword">throw</span> <span class="keyword">new</span> Error()

  <span class="keyword">return</span> edge
}
IperGraph.prototype.getEdge = getEdge

<span class="function"><span class="keyword">function</span> <span class="title">removeEdge</span><span class="params">(id)</span> {</span>
  <span class="keyword">delete</span> <span class="keyword">this</span>.edges[id]
}
IperGraph.prototype.removeEdge = removeEdge

<span class="function"><span class="keyword">function</span> <span class="title">removeNode</span><span class="params">(id)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>loop over all edges</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> <span class="keyword">this</span>.edges) {
    <span class="keyword">var</span> edge = <span class="keyword">this</span>.edges[i]</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>loop over edge nodeIds</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">for</span> (<span class="keyword">var</span> j <span class="keyword">in</span> edge.nodeIds) {
      <span class="keyword">var</span> nodeId = edge.nodeIds[j]</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>remove nodeId from edges linked to removed node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> (id === nodeId)
        edge.nodeIds.splice(j, <span class="number">1</span>)
    }

    <span class="keyword">if</span> (edge.nodeIds.lenght &lt; <span class="number">2</span>)
      edge.remove()
  }

  <span class="keyword">delete</span> <span class="keyword">this</span>.nodes[id]
}
IperGraph.prototype.removeNode = removeNode

<span class="function"><span class="keyword">function</span> <span class="title">createNode</span><span class="params">(data)</span> {</span>
  <span class="keyword">var</span> node = <span class="keyword">new</span> IperNode(<span class="keyword">this</span>, data)
  <span class="keyword">this</span>.nodes[node.id] = node
  <span class="keyword">return</span> node.id
}
IperGraph.prototype.createNode = createNode

<span class="function"><span class="keyword">function</span> <span class="title">getNode</span><span class="params">(id)</span> {</span>
  <span class="keyword">var</span> node = <span class="keyword">this</span>.nodes[id]

  <span class="keyword">if</span> (_.isUndefined(node))
    <span class="keyword">throw</span> <span class="keyword">new</span> Error()

  <span class="keyword">return</span> node
}
IperGraph.prototype.getNode = getNode

<span class="function"><span class="keyword">function</span> <span class="title">deleteNode</span><span class="params">(id)</span> {</span>
  <span class="keyword">delete</span> <span class="keyword">this</span>.nodes[id]
}
IperGraph.prototype.deleteNode = deleteNode

module.exports = IperGraph</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
